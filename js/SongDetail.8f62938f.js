(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["SongDetail"],{1618:function(t,i,e){"use strict";e("5421")},"1f64":function(t,i,e){"use strict";e("fd31")},5421:function(t,i,e){},b6f2:function(t,i,e){"use strict";e.r(i);var n=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"song-detail"},[e("div",{staticClass:"detail-top"},[e("div",{ref:"turnImage",staticClass:"detail-cover turn-stop"},[e("el-image",{staticClass:"cover-image",attrs:{src:this.currentSong.image,lazy:"","preview-src-list":[this.currentSong.image]}},[e("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"})])],1),e("div",{staticClass:"detail-text"},[e("div",{staticClass:"detail-info"},[e("div",{staticClass:"info-big"},[t._v(t._s(this.currentSong.name))]),e("div",{staticClass:"info-small"},[t._v("歌手："+t._s(this.currentSong.singer))]),e("div",{staticClass:"info-small"},[t._v("专辑："),e("span",{staticClass:"album-h",on:{click:t.handleAlbumDetail}},[t._v(t._s(this.currentSong.album))])])]),t.lyrics?e("div",{staticClass:"detail-lyric"},[e("div",{staticClass:"lyric-move",style:t.lyricTop},t._l(t.lyricArray,(function(i,n){return e("div",{key:n,staticClass:"lyric-basic",class:{"lyric-active":t.lyricIndex===n}},[t._v(t._s(i.content)+" ")])})),0)]):t.lyrics||t.lyricLoading?t._e():e("div",{staticClass:"no-lyric"},[t._v("~~ 没有歌词哦 ~~")])])]),e("div",{staticClass:"detail-bottom"},[e("div",{staticClass:"comments"},[e("div",{staticClass:"hot-comment"},[e("div",{staticClass:"hot-title"},[t._v("精彩评论")]),e("comments",{attrs:{comments:t.hotComments,loading:t.hotLoading}}),e("div",{staticClass:"has-more"},[t.hasMoreHot?e("el-button",{staticClass:"more-btn",on:{click:t.handleMoreHot}},[t._v("更多精彩评论"),e("i",{staticClass:"el-icon-arrow-right"})]):t._e()],1),e("el-dialog",{attrs:{title:"精彩评论",visible:t.dialogVisible},on:{"update:visible":function(i){t.dialogVisible=i}}},[e("comments",{attrs:{comments:t.hotTotal,loading:t.hotTotalLoading}})],1)],1),e("div",{staticClass:"new-comment"},[e("div",{staticClass:"new-title"},[t._v("最新评论（"+t._s(t.newTotalCount)+"）")]),e("comments",{attrs:{comments:t.newComments,loading:t.newLoading}}),e("div",{staticClass:"new-bottom"},[e("el-pagination",{attrs:{background:"",layout:"prev,pager,next,jumper","page-size":10,total:t.newTotalCount,"current-page":t.currentPage},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(i){t.currentPage=i},"update:current-page":function(i){t.currentPage=i}}})],1)],1)]),e("div",{staticClass:"detail-simi"},[e("div",{staticClass:"simi-title"},[t._v("相似歌曲")]),t._l(t.simiSongs,(function(i,n){return e("div",{key:n,staticClass:"simi-item",on:{mouseenter:function(i){return t.handleSimiEnter(n)},mouseleave:t.handleSimiLeave}},[e("div",{staticClass:"item-cover"},[e("el-image",{staticClass:"item-image",attrs:{src:i.album.picUrl,lazy:""}}),t.showBtn===n?e("div",{staticClass:"item-btn"},[e("i",{staticClass:"el-icon-video-play btn-icon",on:{click:function(i){return t.handlePlaySimi(n)}}})]):t._e()],1),e("div",{staticClass:"item-info"},[e("div",{staticClass:"info-name"},[t._v(t._s(i.name))]),e("div",[t._v(t._s(t.getSimiSinger(i.artists)))])])])}))],2)])])},s=[],a=e("b85c"),o=e("5530"),r=(e("d3b7"),e("1276"),e("ac1f"),e("d81d"),e("a15b"),e("ca00")),c=e("2f62"),l=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"comments",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},t._l(t.comments,(function(i){return e("div",{key:i.commentId,staticClass:"hot-item"},[e("el-image",{staticClass:"hot-avatar",attrs:{fit:"cover",src:i.user.avatarUrl,lazy:""},on:{click:function(e){return t.handleUser(i.user.userId)}}}),e("div",{staticClass:"hot-left"},[e("div",{staticClass:"left-comment"},[e("span",{staticClass:"user-name",on:{click:function(e){return t.handleUser(i.user.userId)}}},[t._v(t._s(i.user.nickname))]),t._v("："+t._s(i.content)+" ")]),i.beReplied&&i.beReplied.length>0?e("div",{staticClass:"children-comment"},[e("span",{staticClass:"user-name",on:{click:function(e){return t.handleUser(i.beReplied[0].user.userId)}}},[t._v(t._s(i.beReplied[0].user.nickname))]),t._v("："+t._s(i.beReplied[0].content)+" ")]):t._e(),e("div",{staticClass:"left-bottom"},[e("span",[t._v(t._s(t.toGetYMD(i.time)))]),e("span",[e("i",{staticClass:"el-icon-thumb"}),t._v(t._s(i.likedCount))])])])],1)})),0)},u=[],m={name:"Comments",props:{comments:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1}},methods:{toGetYMD:function(t){return Object(r["f"])(t)},handleUser:function(t){this.$router.push({name:"user-detail",query:{id:t}})}}},d=m,h=(e("1f64"),e("2877")),g=Object(h["a"])(d,l,u,!1,null,"1d3b1aeb",null),f=g.exports,v={name:"SongDetail",components:{Comments:f},computed:Object(o["a"])(Object(o["a"])(Object(o["a"])({},Object(c["c"])(["currentSong"])),Object(c["e"])(["playing","currentTime"])),{},{songId:function(){return this.currentSong.id},lyricTop:function(){var t,i=37,e=0,n=Object(a["a"])(this.lyricArray);try{for(n.s();!(t=n.n()).done;){var s=t.value;this.currentTime>=s.time&&e++}}catch(o){n.e(o)}finally{n.f()}return e>5?{top:-i*(e-5)+"px"}:{top:"0px"}}}),watch:{songId:function(){this.initialize(),this.currentPage=1,this.hotTotal=[]},playing:function(){this.turnOrStop()},currentTime:function(t){if(this.lyrics){for(var i=-1,e=0;e<this.lyricArray.length;e++)t>this.lyricArray[e].time&&(i=e);this.lyricIndex=i}}},data:function(){return{lyrics:"",lyricLoading:!1,lyricArray:[],lyricIndex:-1,hotComments:[],hasMoreHot:!1,hotTotal:[],hotTotalCount:0,hotLoading:!1,hotTotalLoading:!1,newComments:[],newTotalCount:0,currentPage:1,newLoading:!1,simiSongs:[],showBtn:-1,dialogVisible:!1}},methods:Object(o["a"])(Object(o["a"])({},Object(c["b"])(["getLyric","getSongDetails","getSimiSong","selectPlay","getCommentHot","getAllComments"])),{},{initialize:function(){this.getHotComments(),this.getNewComments(),this.getSongLyrics(),this.getSimiSongs(),this.turnOrStop()},getSongLyrics:function(){var t=this;this.lyrics="",this.lyricLoading=!0,this.getLyric(this.songId).then((function(i){i.lrc&&(t.lyrics=i.lrc.lyric,t.splitLyrics())})).catch((function(){t.$message.error("获取歌词失败")})).finally((function(){t.lyricLoading=!1}))},getSimiSongs:function(){var t=this;this.getSimiSong(this.songId).then((function(i){t.simiSongs=i.songs})).catch((function(){t.$message.error("获取相似音乐失败")}))},turnOrStop:function(){!0===this.playing?this.$refs.turnImage.classList.remove("turn-stop"):this.$refs.turnImage.classList.add("turn-stop")},splitLyrics:function(){for(var t=this.lyrics.split(/\[|\]/g),i=[],e=1;e<t.length;e+=2){var n=t[e].substr(0,2),s=t[e].substr(3,2),a=60*n+1*s;i.push({time:a,content:t[e+1]})}this.lyricArray=i},getSimiSinger:function(t){return Object(r["e"])(t)},handleSimiEnter:function(t){this.showBtn=t},handleSimiLeave:function(){this.showBtn=-1},handlePlaySimi:function(t){var i=this,e=[];this.simiSongs.map((function(t){e.push(t.id)}));var n=e.join(",");this.getSongDetails(n).then((function(e){var n=[];e.songs.map((function(t){n.push(Object(r["a"])(t))})),i.selectPlay({list:n,index:t})})).catch((function(){i.$message.error("切换失败")}))},getHotComments:function(){var t=this;this.hotLoading=!0;var i={id:this.songId,type:0,limit:10};this.getCommentHot(i).then((function(i){t.hotComments=i.hotComments,t.hasMoreHot=i.hasMore,t.hotTotalCount=i.total})).catch((function(){t.$message.error("获取热门评论失败")})).finally((function(){t.hotLoading=!1}))},handleAlbumDetail:function(){this.$router.push({name:"album-detail",query:{id:this.currentSong.albumId}})},handleMoreHot:function(){var t=this;this.dialogVisible=!0,this.hotTotalLoading=!0;var i={id:this.songId,type:0,limit:this.hotTotalCount};this.getCommentHot(i).then((function(i){t.hotTotal=i.hotComments})).catch((function(){t.$message.error("获取热门评论失败")})).finally((function(){t.hotTotalLoading=!1}))},getNewComments:function(){var t=this;this.newLoading=!0,this.newComments=[];var i={id:this.songId,limit:10,offset:10*(this.currentPage-1)};this.getAllComments(i).then((function(i){t.newComments=i.comments,t.newTotalCount=i.total})).catch((function(){t.$message.error("获取最新评论失败")})).finally((function(){t.newLoading=!1}))},handleCurrentChange:function(){this.getNewComments()}}),mounted:function(){this.initialize(this.songId)}},C=v,p=(e("1618"),Object(h["a"])(C,n,s,!1,null,"1986c295",null));i["default"]=p.exports},d81d:function(t,i,e){"use strict";var n=e("23e7"),s=e("b727").map,a=e("1dde"),o=a("map");n({target:"Array",proto:!0,forced:!o},{map:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}})},fd31:function(t,i,e){}}]);
//# sourceMappingURL=SongDetail.8f62938f.js.map